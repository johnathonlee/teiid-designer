<?xml version="1.0" encoding="ASCII"?>
<!--
  JBoss, Home of Professional Open Source.

  See the LEGAL.txt file distributed with this work for information regarding copyright ownership and licensing.

  See the AUTHORS.txt file distributed with this work for a full listing of individual contributors.
-->
<xmi:XMI xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:diagram="http://www.metamatrix.com/metamodels/Diagram" xmlns:mmcore="http://www.metamatrix.com/metamodels/Core" xmlns:mmws="http://www.metamatrix.com/metamodels/WebService" xmlns:transformation="http://www.metamatrix.com/metamodels/Transformation">
  <mmcore:ModelAnnotation xmi:uuid="mmuuid:d5811100-15c9-1058-b81b-ba1552691301" primaryMetamodelUri="http://www.metamatrix.com/metamodels/WebService" modelType="VIRTUAL" ProducerName="Teiid Designer" ProducerVersion="5.0">
    <modelImports xmi:uuid="mmuuid:d64818c0-6ee5-1058-9f2a-997c60e77099" name="ResponseFeeDoc" modelLocation="../doc/ResponseFeeDoc.xmi" uuid="mmuuid:b0caa7c0-63f7-104c-9c15-eb3cc688c125" modelType="VIRTUAL" primaryMetamodelUri="http://www.metamatrix.com/metamodels/XmlDocument"/>
    <modelImports xmi:uuid="mmuuid:ecec7c01-15e5-1058-b81b-ba1552691301" name="FeeBillingRequest" modelLocation="../xsd/FeeBillingRequest.xsd" modelType="TYPE" primaryMetamodelUri="http://www.eclipse.org/xsd/2002/XSD"/>
    <modelImports xmi:uuid="mmuuid:78036380-4c09-1059-8508-9fc15643dd05" name="FeeBillingResponse" modelLocation="../xsd/FeeBillingResponse.xsd" modelType="TYPE" primaryMetamodelUri="http://www.eclipse.org/xsd/2002/XSD"/>
  </mmcore:ModelAnnotation>
  <diagram:DiagramContainer xmi:uuid="mmuuid:4d7d0240-15ca-1058-b81b-ba1552691301">
    <diagram xmi:uuid="mmuuid:4d7d0241-15ca-1058-b81b-ba1552691301" type="packageDiagramType" target="mmuuid/d5811100-15c9-1058-b81b-ba1552691301">
      <diagramEntity xmi:uuid="mmuuid:5a4fa500-15ce-1058-b81b-ba1552691301" modelObject="mmuuid/a9a49800-15cd-1058-b81b-ba1552691301" xPosition="20" yPosition="20"/>
    </diagram>
    <diagram xmi:uuid="mmuuid:4563cf40-15ce-1058-b81b-ba1552691301" type="packageDiagramType" target="mmuuid/a9a49800-15cd-1058-b81b-ba1552691301">
      <diagramEntity xmi:uuid="mmuuid:1f232900-15d5-1058-b81b-ba1552691301" modelObject="mmuuid/a1aae900-15d3-1058-b81b-ba1552691301" xPosition="40" yPosition="30"/>
    </diagram>
    <diagram xmi:uuid="mmuuid:221e1980-15d5-1058-b81b-ba1552691301" type="transformationDiagramType" target="mmuuid/a1aae900-15d3-1058-b81b-ba1552691301">
      <diagramEntity xmi:uuid="mmuuid:264a3700-15d5-1058-b81b-ba1552691301" name="feeDetails" modelObject="mmuuid/a1aae900-15d3-1058-b81b-ba1552691301" xPosition="30" yPosition="50"/>
      <diagramEntity xmi:uuid="mmuuid:26e2cd80-15d5-1058-b81b-ba1552691301" name="T" modelObject="mmuuid/78018400-15d4-1058-b81b-ba1552691301" xPosition="198" yPosition="50"/>
      <diagramEntity xmi:uuid="mmuuid:3f14ad40-496c-1058-9f2a-997c60e77099" name="IAD" xPosition="406" yPosition="50">
        <modelObject href="../doc/ResponseFeeDoc.xmi#mmuuid/20078200-1ffb-1058-a312-a821f9afe979"/>
      </diagramEntity>
      <diagramEntity xmi:uuid="mmuuid:d997bbc0-4c71-1058-9f2a-997c60e77099" xPosition="564" yPosition="50">
        <modelObject href="../doc/ResponseFeeDoc.xmi#mmuuid/a376f040-e51c-1057-990a-d46259cade85"/>
      </diagramEntity>
    </diagram>
  </diagram:DiagramContainer>
  <mmcore:AnnotationContainer xmi:uuid="mmuuid:3e3cc140-15ce-1058-b81b-ba1552691301"/>
  <transformation:TransformationContainer xmi:uuid="mmuuid:3e3cc141-15ce-1058-b81b-ba1552691301">
    <transformationMappings xsi:type="transformation:SqlTransformationMappingRoot" xmi:uuid="mmuuid:78018400-15d4-1058-b81b-ba1552691301" outputs="mmuuid/a1aae900-15d3-1058-b81b-ba1552691301" target="mmuuid/a1aae900-15d3-1058-b81b-ba1552691301">
      <helper xsi:type="transformation:SqlTransformation" xmi:uuid="mmuuid:78018401-15d4-1058-b81b-ba1552691301" selectSql="CREATE VIRTUAL PROCEDURE&#xa;BEGIN&#xa;DECLARE string VARIABLES.IN_serviceFeeType = xpathvalue(mmuuid:0097e280-15e6-1058-b81b-ba1552691301, '/*:ServiceFeeRequest/*:serviceFee/*:serviceFeeType');&#xa;DECLARE string VARIABLES.IN_serviceFeeEligibilityDate = xpathvalue(mmuuid:0097e280-15e6-1058-b81b-ba1552691301, '/*:ServiceFeeRequest/*:serviceFee/*:serviceFeeEligibilityDate');&#xa;DECLARE string VARIABLES.IN_serviceFeeEligibilityFrequency = xpathvalue(mmuuid:0097e280-15e6-1058-b81b-ba1552691301, '/*:ServiceFeeRequest/*:serviceFee/*:serviceFeeEligibilityFrequency');&#xa;DECLARE string VARIABLES.IN_minimumServiceUsageFeeDays = xpathvalue(mmuuid:0097e280-15e6-1058-b81b-ba1552691301, '/*:ServiceFeeRequest/*:serviceFee/*:minimumServiceUsageFeeDays');&#xa;DECLARE string VARIABLES.IN_serviceInitiationEntityType = xpathvalue(mmuuid:0097e280-15e6-1058-b81b-ba1552691301, '/*:ServiceFeeRequest/*:serviceFee/*:serviceInitiationEntityType');&#xa;DECLARE string VARIABLES.IN_serviceFeeLastInstallmentCheck = xpathvalue(mmuuid:0097e280-15e6-1058-b81b-ba1552691301, '/*:ServiceFeeRequest/*:serviceFee/*:serviceFeeLastInstallmentCheck');&#xa;DECLARE string VARIABLES.IN_planNumber = xpathvalue(mmuuid:0097e280-15e6-1058-b81b-ba1552691301, '/*:ServiceFeeRequest/*:plan/*:planNumber');&#xa;IF(VARIABLES.IN_SERVICEINITIATIONENTITYTYPE = 'ING')&#xa;BEGIN&#xa;IF(VARIABLES.IN_SERVICEFEETYPE = 'IAD')&#xa;BEGIN&#xa;IF(VARIABLES.IN_SERVICEFEELASTINSTALLMENTCHECK = 'true')&#xa;BEGIN&#xa;DECLARE date VARIABLES.LAST_INST_PLUS_ONE;&#xa;VARIABLES.LAST_INST_PLUS_ONE = convert(xpathvalue(mmuuid:0097e280-15e6-1058-b81b-ba1552691301, '/*:ServiceFeeRequest/*:serviceFee/*:serviceFeeEligibilityDate'), date);&#xa;IF(VARIABLES.IN_SERVICEFEEELIGIBILITYFREQUENCY = 'Annual')&#xa;BEGIN&#xa;VARIABLES.LAST_INST_PLUS_ONE = TIMESTAMPADD(SQL_TSI_MONTH, 12, VARIABLES.LAST_INST_PLUS_ONE);&#xa;ERROR (('ANNUAL ' || VARIABLES.LAST_INST_PLUS_ONE) || '  ');&#xa;END&#xa;ELSE&#xa;BEGIN&#xa;IF(VARIABLES.IN_SERVICEFeeElIGIBILITYFREQUENCY = 'Quarterly')&#xa;BEGIN&#xa;VARIABLES.LAST_INST_PLUS_ONE = TIMESTAMPADD(SQL_TSI_MONTH, 3, VARIABLES.LAST_INST_PLUS_ONE);&#xa;END&#xa;ELSE&#xa;BEGIN&#xa;IF(VARIABLES.IN_SERVICEFEEELIGIBILITYFREQUENCY = 'Semi-Annual')&#xa;BEGIN&#xa;VARIABLES.LAST_INST_PLUS_ONE = TIMESTAMPADD(SQL_TSI_MONTH, 6, VARIABLES.LAST_INST_PLUS_ONE);&#xa;END&#xa;ELSE&#xa;BEGIN&#xa;ERROR (('Unsupported Frequency [' || VARIABLES.IN_SERVICEFEEELIGIBILITYFREQUENCY) || ']');&#xa;END&#xa;END&#xa;END&#xa;SELECT * FROM mmuuid:20078200-1ffb-1058-a312-a821f9afe979 WHERE (mmuuid:6d556d40-20b1-1058-a312-a821f9afe979 = VARIABLES.IN_PLANNUMBER) AND (mmuuid:b87cf440-21a2-1058-a312-a821f9afe979 = VARIABLES.LAST_INST_PLUS_ONE);&#xa;END&#xa;ELSE&#xa;BEGIN&#xa;SELECT * FROM mmuuid:20078200-1ffb-1058-a312-a821f9afe979 WHERE (mmuuid:6d556d40-20b1-1058-a312-a821f9afe979 = VARIABLES.IN_PLANNUMBER) AND (mmuuid:b87cf440-21a2-1058-a312-a821f9afe979 = {d'1900-01-01'});&#xa;END&#xa;END&#xa;ELSE&#xa;BEGIN&#xa;IF(VARIABLES.IN_SERVICEFEETYPE = 'ADV')&#xa;BEGIN&#xa;SELECT * FROM mmuuid:a376f040-e51c-1057-990a-d46259cade85 WHERE (mmuuid:310f7f40-4cdc-1058-9f2a-997c60e77099 = xpathvalue(mmuuid:0097e280-15e6-1058-b81b-ba1552691301, '/*:ServiceFeeRequest/*:serviceFee/*:minimumServiceUsageFeeDays')) AND (mmuuid:0c30e600-e5d5-1057-990a-d46259cade85 = xpathvalue(mmuuid:0097e280-15e6-1058-b81b-ba1552691301, '/*:ServiceFeeRequest/*:plan/*:planNumber')) AND (mmuuid:e426fc00-e5dc-1057-990a-d46259cade85 = convert(xpathvalue(mmuuid:0097e280-15e6-1058-b81b-ba1552691301, '/*:ServiceFeeRequest/*:serviceFee/*:serviceFeeEligibilityDate'), date));&#xa;END&#xa;ELSE&#xa;BEGIN&#xa;ERROR ((' Unknown service fee type [' || VARIABLES.IN_SERVICEFEETYPE) || ']');&#xa;END&#xa;END&#xa;END&#xa;ELSE&#xa;BEGIN&#xa;ERROR ((' Unknown service Initiation Entity Type [' || VARIABLES.IN_serviceInitiationEntityType) || ']');&#xa;END&#xa;SELECT * FROM mmuuid:20078200-1ffb-1058-a312-a821f9afe979;&#xa;END">
        <nested xsi:type="transformation:SqlTransformation" xmi:uuid="mmuuid:78018402-15d4-1058-b81b-ba1552691301" selectSql="CREATE VIRTUAL PROCEDURE&#xa;BEGIN&#xa;DECLARE string VARIABLES.IN_serviceFeeType = xpathvalue(ServiceFee.getParticipanteEligibleForService.feeDetails.NewInput, '/*:ServiceFeeRequest/*:serviceFee/*:serviceFeeType');&#xa;DECLARE string VARIABLES.IN_serviceFeeEligibilityDate = xpathvalue(ServiceFee.getParticipanteEligibleForService.feeDetails.NewInput, '/*:ServiceFeeRequest/*:serviceFee/*:serviceFeeEligibilityDate');&#xa;DECLARE string VARIABLES.IN_serviceFeeEligibilityFrequency = xpathvalue(ServiceFee.getParticipanteEligibleForService.feeDetails.NewInput, '/*:ServiceFeeRequest/*:serviceFee/*:serviceFeeEligibilityFrequency');&#xa;DECLARE string VARIABLES.IN_minimumServiceUsageFeeDays = xpathvalue(ServiceFee.getParticipanteEligibleForService.feeDetails.NewInput, '/*:ServiceFeeRequest/*:serviceFee/*:minimumServiceUsageFeeDays');&#xa;DECLARE string VARIABLES.IN_serviceInitiationEntityType = xpathvalue(ServiceFee.getParticipanteEligibleForService.feeDetails.NewInput, '/*:ServiceFeeRequest/*:serviceFee/*:serviceInitiationEntityType');&#xa;DECLARE string VARIABLES.IN_serviceFeeLastInstallmentCheck = xpathvalue(ServiceFee.getParticipanteEligibleForService.feeDetails.NewInput, '/*:ServiceFeeRequest/*:serviceFee/*:serviceFeeLastInstallmentCheck');&#xa;DECLARE string VARIABLES.IN_planNumber = xpathvalue(ServiceFee.getParticipanteEligibleForService.feeDetails.NewInput, '/*:ServiceFeeRequest/*:plan/*:planNumber');&#xa;IF(VARIABLES.IN_SERVICEINITIATIONENTITYTYPE = 'ING')&#xa;BEGIN&#xa;IF(VARIABLES.IN_SERVICEFEETYPE = 'IAD')&#xa;BEGIN&#xa;IF(VARIABLES.IN_SERVICEFEELASTINSTALLMENTCHECK = 'true')&#xa;BEGIN&#xa;DECLARE date VARIABLES.LAST_INST_PLUS_ONE;&#xa;VARIABLES.LAST_INST_PLUS_ONE = convert(xpathvalue(ServiceFee.getParticipanteEligibleForService.feeDetails.NewInput, '/*:ServiceFeeRequest/*:serviceFee/*:serviceFeeEligibilityDate'), date);&#xa;IF(VARIABLES.IN_SERVICEFEEELIGIBILITYFREQUENCY = 'Annual')&#xa;BEGIN&#xa;VARIABLES.LAST_INST_PLUS_ONE = TIMESTAMPADD(SQL_TSI_MONTH, 12, VARIABLES.LAST_INST_PLUS_ONE);&#xa;ERROR (('ANNUAL ' || VARIABLES.LAST_INST_PLUS_ONE) || '  ');&#xa;END&#xa;ELSE&#xa;BEGIN&#xa;IF(VARIABLES.IN_SERVICEFeeElIGIBILITYFREQUENCY = 'Quarterly')&#xa;BEGIN&#xa;VARIABLES.LAST_INST_PLUS_ONE = TIMESTAMPADD(SQL_TSI_MONTH, 3, VARIABLES.LAST_INST_PLUS_ONE);&#xa;END&#xa;ELSE&#xa;BEGIN&#xa;IF(VARIABLES.IN_SERVICEFEEELIGIBILITYFREQUENCY = 'Semi-Annual')&#xa;BEGIN&#xa;VARIABLES.LAST_INST_PLUS_ONE = TIMESTAMPADD(SQL_TSI_MONTH, 6, VARIABLES.LAST_INST_PLUS_ONE);&#xa;END&#xa;ELSE&#xa;BEGIN&#xa;ERROR (('Unsupported Frequency [' || VARIABLES.IN_SERVICEFEEELIGIBILITYFREQUENCY) || ']');&#xa;END&#xa;END&#xa;END&#xa;SELECT * FROM ResponseFeeDoc.IAD WHERE (ResponseFeeDoc.IAD.ServiceFeeResponse.eligibleParticipant.PLAN_NUMBER_IN = VARIABLES.IN_PLANNUMBER) AND (ResponseFeeDoc.IAD.ServiceFeeResponse.eligibleParticipant.LAST_INSTALLMENT_DATE_IN = VARIABLES.LAST_INST_PLUS_ONE);&#xa;END&#xa;ELSE&#xa;BEGIN&#xa;SELECT * FROM ResponseFeeDoc.IAD WHERE (ResponseFeeDoc.IAD.ServiceFeeResponse.eligibleParticipant.PLAN_NUMBER_IN = VARIABLES.IN_PLANNUMBER) AND (ResponseFeeDoc.IAD.ServiceFeeResponse.eligibleParticipant.LAST_INSTALLMENT_DATE_IN = {d'1900-01-01'});&#xa;END&#xa;END&#xa;ELSE&#xa;BEGIN&#xa;IF(VARIABLES.IN_SERVICEFEETYPE = 'ADV')&#xa;BEGIN&#xa;SELECT * FROM ResponseFeeDoc.ADV WHERE (ResponseFeeDoc.ADV.ServiceFeeResponse.eligibleParticipant.MINIMUM_DAYS_IN = xpathvalue(ServiceFee.getParticipanteEligibleForService.feeDetails.NewInput, '/*:ServiceFeeRequest/*:serviceFee/*:minimumServiceUsageFeeDays')) AND (ResponseFeeDoc.ADV.ServiceFeeResponse.eligibleParticipant.PLAN_NUMBER_IN = xpathvalue(ServiceFee.getParticipanteEligibleForService.feeDetails.NewInput, '/*:ServiceFeeRequest/*:plan/*:planNumber')) AND (ResponseFeeDoc.ADV.ServiceFeeResponse.eligibleParticipant.END_DATE_IN = convert(xpathvalue(ServiceFee.getParticipanteEligibleForService.feeDetails.NewInput, '/*:ServiceFeeRequest/*:serviceFee/*:serviceFeeEligibilityDate'), date));&#xa;END&#xa;ELSE&#xa;BEGIN&#xa;ERROR ((' Unknown service fee type [' || VARIABLES.IN_SERVICEFEETYPE) || ']');&#xa;END&#xa;END&#xa;END&#xa;ELSE&#xa;BEGIN&#xa;ERROR ((' Unknown service Initiation Entity Type [' || VARIABLES.IN_serviceInitiationEntityType) || ']');&#xa;END&#xa;SELECT * FROM ResponseFeeDoc.IAD;&#xa;END"/>
        <aliases xmi:uuid="mmuuid:4c16de80-4c70-1058-9f2a-997c60e77099" alias="ADV">
          <aliasedObject href="../doc/ResponseFeeDoc.xmi#mmuuid/a376f040-e51c-1057-990a-d46259cade85"/>
        </aliases>
        <aliases xmi:uuid="mmuuid:236ab680-1bfc-1059-9229-d512cc0e8ce0" alias="IAD">
          <aliasedObject href="../doc/ResponseFeeDoc.xmi#mmuuid/20078200-1ffb-1058-a312-a821f9afe979"/>
        </aliases>
      </helper>
      <nested xsi:type="transformation:TransformationMapping" xmi:uuid="mmuuid:ecec7c00-15e5-1058-b81b-ba1552691301" outputs="mmuuid/e9f18b81-15e5-1058-b81b-ba1552691301"/>
      <inputs href="../doc/ResponseFeeDoc.xmi#mmuuid/a376f040-e51c-1057-990a-d46259cade85"/>
      <inputs href="../doc/ResponseFeeDoc.xmi#mmuuid/20078200-1ffb-1058-a312-a821f9afe979"/>
    </transformationMappings>
  </transformation:TransformationContainer>
  <mmws:Interface xmi:uuid="mmuuid:a9a49800-15cd-1058-b81b-ba1552691301" name="getParticipanteEligibleForService">
    <operations xmi:uuid="mmuuid:a1aae900-15d3-1058-b81b-ba1552691301" name="feeDetails">
      <input xmi:uuid="mmuuid:0097e280-15e6-1058-b81b-ba1552691301" name="NewInput">
        <contentElement href="../xsd/FeeBillingRequest.xsd#//ServiceFeeRequest;XSDElementDeclaration"/>
      </input>
      <output xmi:uuid="mmuuid:78018404-15d4-1058-b81b-ba1552691301" name="NewOutput">
        <contentElement href="../xsd/FeeBillingResponse.xsd#//ServiceFeeResponse;XSDElementDeclaration"/>
        <samples xmi:uuid="mmuuid:e9f18b81-15e5-1058-b81b-ba1552691301"/>
        <xmlDocument href="../doc/ResponseFeeDoc.xmi#mmuuid/20078200-1ffb-1058-a312-a821f9afe979"/>
      </output>
    </operations>
  </mmws:Interface>
</xmi:XMI>
